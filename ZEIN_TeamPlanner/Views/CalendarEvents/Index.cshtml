@model IEnumerable<ZEIN_TeamPlanner.Models.CalendarEvent>

@{
    ViewData["Title"] = "Events - " + ViewBag.GroupName;
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="~/css/calendarEventIndex.css" />

<div class="header-row">
    <a asp-controller="Groups" asp-action="Index" class="btn btn-primary" style="background: linear-gradient(to right, #00AE72, #00c4b4); border: none;">
        <i class="bi bi-arrow-left"></i> Back to Group
    </a>
    <h2>Events for @ViewBag.GroupName</h2>
    @if (!ViewBag.IsMember)
    {
        <a asp-action="Create" asp-route-groupId="@ViewBag.GroupId" class="btn btn-primary create-event-btn">
            <i class="bi bi-plus-circle"></i> Create New Event
        </a>
    }
    else
    {
        <div></div> <!-- Empty div to maintain header row spacing -->
    }
</div>

@if (Model.Any())
{
    @foreach (var calendarEvent in Model)
    {
        <div class="event-card card">
            <div class="card-header">
                <h5 class="mb-0">
                    <a asp-controller="Groups" asp-action="Details" asp-route-id="@calendarEvent.GroupId" class="text-white text-decoration-none">
                        @(ViewBag.GroupName ?? "Unknown Group")
                    </a>
                </h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">@calendarEvent.Title</h6>
                <div class="event-details">
                    <div>
                        <strong>Description:</strong> @(calendarEvent.Description?.Length > 50 ? calendarEvent.Description.Substring(0, 50) + "..." : calendarEvent.Description ?? "")
                    </div>
                    <div>
                        <strong>Start Time:</strong> @calendarEvent.StartTime.ToString("dd MMM yyyy HH:mm")
                    </div>
                    <div>
                        <strong>End Time:</strong> @(calendarEvent.EndTime?.ToString("dd MMM yyyy HH:mm") ?? "No end time")
                    </div>
                    <div>
                        <strong>Type:</strong> @calendarEvent.Type
                    </div>
                    <div>
                        <strong>Is All Day:</strong> @(calendarEvent.IsAllDay ? "Yes" : "No")
                    </div>
                    <div>
                        <strong>Recurrence:</strong> @(calendarEvent.RecurrenceRule ?? "None")
                    </div>
                </div>
            </div>
            <div class="card-footer action-buttons">
                <a asp-action="Details" asp-route-id="@calendarEvent.CalendarEventId" class="icon-btn info" title="View Details">
                    <i class="bi bi-eye"></i>
                </a>
                @if (!ViewBag.IsMember)
                {
                    <a asp-action="Edit" asp-route-id="@calendarEvent.CalendarEventId" class="icon-btn secondary" title="Edit">
                        <i class="bi bi-pencil"></i>
                    </a>
                }
            </div>
        </div>
    }
}
else
{
    <div class="alert alert-warning">
        No events found for this group. Create an event to get started!
    </div>
}

<div class="mt-3">
    <a asp-controller="CalendarEvents" asp-action="Calendar" asp-route-groupId="@ViewBag.GroupId" class="btn btn-secondary">
        <i class="bi bi-calendar"></i> View Events in Calendar
    </a>
    <a asp-controller="Groups" asp-action="Index" class="btn btn-primary" style="background: linear-gradient(to right, #00AE72, #00c4b4); border: none;">
        <i class="bi bi-arrow-left"></i> Back to Groups
    </a>
</div>